<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets/app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:6,&quot;tests&quot;:6,&quot;passes&quot;:3,&quot;pending&quot;:3,&quot;failures&quot;:0,&quot;start&quot;:&quot;2021-08-10T15:04:23.754Z&quot;,&quot;end&quot;:&quot;2021-08-10T15:04:24.004Z&quot;,&quot;duration&quot;:250,&quot;testsRegistered&quot;:6,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:50,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false},&quot;results&quot;:[{&quot;uuid&quot;:&quot;cc4cdc5d-26c9-4970-a32a-e2ba7405548a&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;&quot;,&quot;file&quot;:&quot;&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;61a58ef9-4cb3-44b5-845c-3cb032d6b47c&quot;,&quot;title&quot;:&quot;pollForApplications eApp specific&quot;,&quot;fullFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/test/specs/pollForApplications.spec.js&quot;,&quot;file&quot;:&quot;/test/specs/pollForApplications.spec.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;33b2ce46-f008-41e9-bcad-f2974f1dc8e5&quot;,&quot;title&quot;:&quot;processElectronicApplication&quot;,&quot;fullFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/test/specs/pollForApplications.spec.js&quot;,&quot;file&quot;:&quot;/test/specs/pollForApplications.spec.js&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;processElectronicApplication\&quot;&quot;,&quot;fullTitle&quot;:&quot;pollForApplications eApp specific processElectronicApplication \&quot;before each\&quot; hook in \&quot;processElectronicApplication\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:44,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.stub(dbModels.Application, &#x27;findOne&#x27;).resolves({\n    dataValues: {\n        application_id: 12345,\n        submissionAttempts: 0,\n        submitted: &#x27;queued&#x27;,\n        serviceType: 4,\n    },\n});\nfindOneExportedData = sinon\n    .stub(dbModels.ExportedEAppData, &#x27;findOne&#x27;)\n    .resolves(eAppData);\nfindAllUploadedDocuments = sinon\n    .stub(dbModels.UploadedDocumentUrls, &#x27;findAll&#x27;)\n    .resolves(documentData);\nsinon.stub(request, &#x27;post&#x27;).callsFake(() =&gt; null);\nsinon.spy(console, &#x27;log&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0e303892-d988-4998-9139-6fc2e45b5a93&quot;,&quot;parentUUID&quot;:&quot;33b2ce46-f008-41e9-bcad-f2974f1dc8e5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;processElectronicApplication\&quot;&quot;,&quot;fullTitle&quot;:&quot;pollForApplications eApp specific processElectronicApplication \&quot;after each\&quot; hook in \&quot;processElectronicApplication\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;sinon.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1168b021-5f99-4541-8a98-6ba08f80ecbc&quot;,&quot;parentUUID&quot;:&quot;33b2ce46-f008-41e9-bcad-f2974f1dc8e5&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should run electronic applicaiton process if serviceType is 4&quot;,&quot;fullTitle&quot;:&quot;pollForApplications eApp specific processElectronicApplication should run electronic applicaiton process if serviceType is 4&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// when\ncheckForApplications();\n// then\nassertWhenPromisesResolved(\n    () =&gt;\n        expect(console.log.calledWith(&#x27;Processing electronic app&#x27;))\n            .to.be.true\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1c049d9a-de0c-4512-b530-036cfb36f106&quot;,&quot;parentUUID&quot;:&quot;33b2ce46-f008-41e9-bcad-f2974f1dc8e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should fetch all the uploaded doc urls related to an application&quot;,&quot;fullTitle&quot;:&quot;pollForApplications eApp specific processElectronicApplication should fetch all the uploaded doc urls related to an application&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:2,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// when\ncheckForApplications();\n// then\nassertWhenPromisesResolved(\n    () =&gt;\n        expect(\n            findOneExportedData.calledWith({\n                where: {\n                    application_id: 12345,\n                },\n            })\n        ).to.be.true\n);\nassertWhenPromisesResolved(\n    () =&gt;\n        expect(\n            findAllUploadedDocuments.calledWith({\n                where: {\n                    application_id: 12345,\n                },\n            })\n        ).to.be.true\n);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5022122d-ed0e-4e31-b0d6-359c85726e3a&quot;,&quot;parentUUID&quot;:&quot;33b2ce46-f008-41e9-bcad-f2974f1dc8e5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1c049d9a-de0c-4512-b530-036cfb36f106&quot;,&quot;5022122d-ed0e-4e31-b0d6-359c85726e3a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:5,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;f9fbd24d-fcf1-466b-a1fd-0f7227eb3e84&quot;,&quot;title&quot;:&quot;createEAppDataObject&quot;,&quot;fullFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/test/specs/pollForApplications.spec.js&quot;,&quot;file&quot;:&quot;/test/specs/pollForApplications.spec.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should fetch all the uploaded doc urls related to an application&quot;,&quot;fullTitle&quot;:&quot;pollForApplications eApp specific createEAppDataObject should fetch all the uploaded doc urls related to an application&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:17,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;code&quot;:&quot;// when\nsinon.useFakeTimers(1628606911103);\nconst dataObject = createEAppDataObject(\n    eAppData.dataValues,\n    documentData\n);\n// then\nconst expectedResult = {\n    legalisationApplication: {\n        userId: &#x27;legalisation&#x27;,\n        caseType: &#x27;eApostille Service&#x27;,\n        timestamp: &#x27;1628606911103&#x27;,\n        applicant: {\n            forenames: &#x27;John&#x27;,\n            surname: &#x27;Doe&#x27;,\n            primaryTelephone: &#x27;+1-202-555-0123&#x27;,\n            mobileTelephone: &#x27;&#x27;,\n            eveningTelephone: &#x27;&#x27;,\n            email: &#x27;joe@example.com&#x27;,\n        },\n        fields: {\n            applicationReference: &#x27;A-D-21-0803-2027-A763&#x27;,\n            documentCount: 1,\n            paymentReference: &#x27;8516279850170300&#x27;,\n            paymentAmount: &#x27;30.00&#x27;,\n            customerInternalReference: &#x27;&#x27;,\n            feedbackConsent: false,\n            companyName: &#x27;N/A&#x27;,\n            companyRegistrationNumber: &#x27;&#x27;,\n            portalCustomerId: 123,\n            additionalInformation: &#x27;&#x27;,\n        },\n        documents: [\n            {\n                name: &#x27;test.pdf&#x27;,\n                downloadUrl: &#x27;https://test.com/test.pdf&#x27;,\n            },\n        ],\n    },\n};\nexpect(dataObject).to.deep.equal(expectedResult);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2ad1a909-2680-4598-bb75-de8307d5bc2c&quot;,&quot;parentUUID&quot;:&quot;f9fbd24d-fcf1-466b-a1fd-0f7227eb3e84&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2ad1a909-2680-4598-bb75-de8307d5bc2c&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:17,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;95050397-cf98-49e3-a983-d28174ebe3e9&quot;,&quot;title&quot;:&quot;Work with Successful Submissions&quot;,&quot;fullFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/test/specs/submission.spec.js&quot;,&quot;file&quot;:&quot;/test/specs/submission.spec.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;processes an application when correct key put on rabbitMQ&quot;,&quot;fullTitle&quot;:&quot;Work with Successful Submissions processes an application when correct key put on rabbitMQ&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;pending&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:true,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;296b28bb-15cd-4dbf-922f-58a593055246&quot;,&quot;parentUUID&quot;:&quot;95050397-cf98-49e3-a983-d28174ebe3e9&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[&quot;296b28bb-15cd-4dbf-922f-58a593055246&quot;],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;e6053463-e466-4b3f-af83-fca8611b03f5&quot;,&quot;title&quot;:&quot;Work with Failed Submissions&quot;,&quot;fullFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/test/specs/submission.spec.js&quot;,&quot;file&quot;:&quot;/test/specs/submission.spec.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;records failure and drops from the queue after max retry attempts&quot;,&quot;fullTitle&quot;:&quot;Work with Failed Submissions records failure and drops from the queue after max retry attempts&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;pending&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:true,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9057949f-9c1f-4ef1-a660-abdaca39e975&quot;,&quot;parentUUID&quot;:&quot;e6053463-e466-4b3f-af83-fca8611b03f5&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[&quot;9057949f-9c1f-4ef1-a660-abdaca39e975&quot;],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000},{&quot;uuid&quot;:&quot;275fd730-e496-4cb0-80de-d06cd3b94704&quot;,&quot;title&quot;:&quot;Behaves correctly after recovering from Failed Submissions&quot;,&quot;fullFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/test/specs/submission.spec.js&quot;,&quot;file&quot;:&quot;/test/specs/submission.spec.js&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;sends to service and stops processing&quot;,&quot;fullTitle&quot;:&quot;Behaves correctly after recovering from Failed Submissions sends to service and stops processing&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;pending&quot;,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:true,&quot;code&quot;:&quot;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10394176-f662-47e3-9afa-5c44c793f775&quot;,&quot;parentUUID&quot;:&quot;275fd730-e496-4cb0-80de-d06cd3b94704&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[&quot;10394176-f662-47e3-9afa-5c44c793f775&quot;],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:2000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:2000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;9.0.3&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:true,&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;6.2.2&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;quiet&quot;:&quot;true&quot;},&quot;version&quot;:&quot;5.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;mochawesome&quot;,&quot;reportDir&quot;:&quot;mochawesome-report&quot;,&quot;reportTitle&quot;:&quot;loi-submission-service&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:true,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report/assets&quot;,&quot;jsonFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/mochawesome-report/mochawesome.json&quot;,&quot;htmlFile&quot;:&quot;/Users/richardoliverbray/loi-submission-service/mochawesome-report/mochawesome.html&quot;}"><div id="report"></div><script src="assets/app.js"></script></body></html>